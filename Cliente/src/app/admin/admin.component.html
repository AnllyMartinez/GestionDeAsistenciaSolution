<div class="admin-dashboard">
  <h3 class="text-center mb-4">Panel de Administración</h3>

  <!-- Gestión de Usuarios -->
  <div class="mb-4">
    <h4>Gestión de Usuarios</h4>
    <div class="d-flex justify-content-between align-items-center mb-3">
      <button
        class="btn btn-outline-dark"
        data-bs-toggle="modal"
        data-bs-target="#crearUsuarioModal"
      >
        Crear Usuario
      </button>
    </div>
    <div class="table-responsive">
      <table class="table table-striped table-bordered">
        <thead class="table-dark">
          <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Email</th>
            <th>Rol</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let usuario of usuarios">
            <td>{{ usuario.usuarioID }}</td>
            <td>{{ usuario.nombre }} {{ usuario.apellido }}</td>
            <td>{{ usuario.email }}</td>
            <td>{{ usuario.rol.nombreRol }}</td>
            <td
              class="d-flex gap-3 align-items-center h-100 align-self-stretch"
            >
              <button
                class="btn btn-outline-dark btn-sm"
                data-bs-toggle="modal"
                data-bs-target="#editarUsuarioModal"
                (click)="editarUsuario(usuario)"
              >
                Editar
              </button>
              <button
                class="btn btn-outline-danger btn-sm"
                (click)="usuarioAEliminarID(usuario.usuarioID)"
                data-bs-toggle="modal"
                data-bs-target="#confirmarEliminarModal"
              >
                Eliminar
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div *ngIf="mensaje" class="mt-3 text-center">
    <div
      [ngClass]="{
        'alert alert-success': mensajeTipo === 'exito',
        'alert alert-danger': mensajeTipo === 'error'
      }"
      role="alert"
    >
      {{ mensaje }}
    </div>
  </div>

  <!-- Filtros y Registros de Asistencia y Horas Laborales -->
  <div>
    <h4>Monitoreo de Registros</h4>
    <div class="d-flex justify-content-between align-items-center mb-3">
      <select class="form-select w-25" [(ngModel)]="selectedUsuarioFilter">
        <option [ngValue]="null">Filtrar por Usuario</option>
        <option *ngFor="let usuario of usuarios" [ngValue]="usuario.usuarioID">
          {{ usuario.nombre }} {{ usuario.apellido }}
        </option>
      </select>
      <input
        type="date"
        class="form-control w-25"
        [(ngModel)]="selectedFechaFilter"
      />
      <button class="btn btn-outline-dark" (click)="filtrarRegistros()">
        Filtrar
      </button>
    </div>
    <div class="mb-4">
      <h5>Registros de Asistencia</h5>
      <table class="table table-striped table-bordered">
        <thead class="table-dark">
          <tr>
            <th>Fecha</th>
            <th>Hora</th>
            <th>Tipo</th>
            <th>Usuario</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let registro of registrosAsistencia">
            <td>{{ registro.fecha }}</td>
            <td>{{ registro.hora }}</td>
            <td>{{ registro.tipo }}</td>
            <td>
              {{ registro.usuario?.nombre }}
              {{ registro.usuario?.apellido }} ({{ registro.usuario?.email }})
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="mb-4">
      <h5>Registros de Horas Laborales</h5>
      <table class="table table-striped table-bordered">
        <thead class="table-dark">
          <tr>
            <th>Fecha</th>
            <th>Hora de Inicio</th>
            <th>Hora de Fin</th>
            <th>Usuario</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let registro of registrosHoras">
            <td>{{ registro.fecha }}</td>
            <td>{{ registro.horaInicio }}</td>
            <td>{{ registro.horaFin }}</td>
            <td>
              {{ registro.usuario?.nombre }}
              {{ registro.usuario?.apellido }} ({{ registro.usuario?.email }})
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Modal: Crear Usuario -->
<div
  class="modal fade"
  id="crearUsuarioModal"
  tabindex="-1"
  aria-labelledby="crearUsuarioModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="crearUsuarioModalLabel">Crear Usuario</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form #crearUsuarioForm="ngForm">
          <div class="mb-3">
            <label for="nombre" class="form-label">Nombre</label>
            <input
              type="text"
              class="form-control"
              id="nombre"
              [(ngModel)]="nombre"
              name="nombre"
              required
            />
          </div>
          <div class="mb-3">
            <label for="apellido" class="form-label">Apellido</label>
            <input
              type="text"
              class="form-control"
              id="apellido"
              [(ngModel)]="apellido"
              name="apellido"
              required
            />
          </div>
          <div class="mb-3">
            <label for="email" class="form-label">Email</label>
            <input
              type="email"
              class="form-control"
              id="email"
              [(ngModel)]="email"
              name="email"
              required
              #emailInput="ngModel"
              pattern="^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$"
            />
            <div
              *ngIf="
                emailInput.invalid && (emailInput.dirty || emailInput.touched)
              "
              class="text-danger mt-1"
            >
              <div *ngIf="emailInput.errors?.required">Email es requerido.</div>
              <div *ngIf="emailInput.errors?.pattern">
                Por favor, ingrese un email válido.
              </div>
            </div>
          </div>
          <div class="mb-3">
            <label for="rol" class="form-label">Rol</label>
            <select
              class="form-select"
              id="rol"
              [(ngModel)]="rol"
              name="rol"
              required
            >
              <option [ngValue]="0">Seleccione un rol</option>
              <option *ngFor="let r of roles" [ngValue]="r.rolID">
                {{ r.nombreRol }}
              </option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-outline-secondary"
          data-bs-dismiss="modal"
        >
          Cerrar
        </button>
        <button
          type="button"
          class="btn btn-outline-dark"
          (click)="crearUsuario()"
          data-bs-dismiss="modal"
          [disabled]="crearUsuarioForm.invalid"
        >
          Crear Usuario
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal: Editar Usuario -->
<div
  class="modal fade"
  id="editarUsuarioModal"
  tabindex="-1"
  aria-labelledby="editarUsuarioModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content" *ngIf="usuarioEditar">
      <div class="modal-header">
        <h5 class="modal-title" id="editarUsuarioModalLabel">Editar Usuario</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="mb-3">
            <label for="nombreEdit" class="form-label">Nombre</label>
            <input
              type="text"
              class="form-control"
              id="nombreEdit"
              [(ngModel)]="usuarioEditar.nombre"
              name="nombreEdit"
              required
            />
          </div>
          <div class="mb-3">
            <label for="apellidoEdit" class="form-label">Apellido</label>
            <input
              type="text"
              class="form-control"
              id="apellidoEdit"
              [(ngModel)]="usuarioEditar.apellido"
              name="apellidoEdit"
              required
            />
          </div>
          <div class="mb-3">
            <label for="emailEdit" class="form-label">Email</label>
            <input
              type="email"
              class="form-control"
              id="emailEdit"
              [(ngModel)]="usuarioEditar.email"
              name="emailEdit"
              required
            />
          </div>
          <div class="mb-3">
            <label for="rolEdit" class="form-label">Rol</label>
            <select
              class="form-select"
              id="rolEdit"
              [(ngModel)]="usuarioEditar.rolID"
              name="rolEdit"
              required
            >
              <option *ngFor="let r of roles" [ngValue]="r.rolID">
                {{ r.nombreRol }}
              </option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cerrar
        </button>
        <button
          type="button"
          class="btn btn-outline-dark"
          (click)="actualizarUsuario()"
          data-bs-dismiss="modal"
        >
          Actualizar Usuario
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal - Confirmar Eliminación de Usuario -->
<div
  class="modal fade"
  id="confirmarEliminarModal"
  tabindex="-1"
  aria-labelledby="confirmarEliminarModal"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Confirmar Eliminación</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        ¿Está seguro de que desea eliminar este usuario?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cancelar
        </button>
        <button
          type="button"
          class="btn btn-outline-danger"
          (click)="confirmarEliminarUsuario()"
          data-bs-dismiss="modal"
        >
          Eliminar
        </button>
      </div>
    </div>
  </div>
</div>
